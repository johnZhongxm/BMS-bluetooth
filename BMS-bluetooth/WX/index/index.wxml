<wxs module="utils">
module.exports.max = function(n1, n2) {
  return Math.max(n1, n2)
}
module.exports.len = function(arr) {
  arr = arr || []
  return arr.length
}
</wxs>

<view class="page">

<view class="page-slidebar">
    <view class="page-content">
      <view class="devices_summary">已发现 {{devices.length}} 个外围设备：</view>
    <scroll-view class="device_list" scroll-y scroll-with-animation>
      <view wx:for="{{devices}}" wx:key="index"
      data-device-id="{{item.deviceId}}"
      data-name="{{item.name || item.localName}}"
      bindtap="createBLEConnection" 
      class="device_item"
      hover-class="device_item_hover">
        <view style="font-size: 16px; color: #333;">{{item.name}}</view>
        <view style="font-size: 10px">信号强度: {{item.RSSI}}dBm ({{utils.max(0, item.RSSI + 100)}}%)</view>
        <view style="font-size: 10px">UUID: {{item.deviceId}}</view>
        <view style="font-size: 10px">Service数量: {{utils.len(item.advertisServiceUUIDs)}}</view>
      </view>
    </scroll-view>

    </view>
  </view>




  <!-- 主页内容 -->
  <!-- （open ? 'c-state' : ''）三元运算符： -->
  <!-- 1.默认情况下 open 为 false -->
  <!-- 2.当点击左上角图标的时候或者屏幕向左滑动，open 变化 true -->
  <!-- 3.当 open 为 true 时，会加上类名为 c-state 和 cover 的 css 样式 -->
  <!-- bindtouchstart、 bindtouchmove、bindtouchend -->
  <!-- 当手指触摸屏幕并滑动时，所触发的三个函数 -->
  <view bindtouchmove="tap_drag" bindtouchend="tap_end" bindtouchstart="tap_start" class="page-top {{open ? ['c-state','cover'] : ''}} ">
    <view class='content'> 
      <view class="itemView">
        <text class="col1 shape batTxt"> 电池1：</text>
        <view class="col1 shape" placeholder="0.0V">{{BatV[0]}}</view> 
        <text class="col2 shape batTxt"> 电池2：</text>
        <view class="col2 shape" placeholder="0.0V"> {{BatV[1]}} </view>
        <text class="col1 shape batTxt"> 电池3：</text>
        <view class="col1 shape" placeholder="0.0V"> {{BatV[2]}} </view>
        <text class="col2 shape batTxt"> 电池4：</text>
        <view class="col2 shape" placeholder="0.0V"> {{BatV[3]}} </view>
      </view>
      <view class="itemView">
        <text class="col1 shape batTxt"> 电池5：</text>
        <view class="col1 shape" placeholder="0.0V">{{BatV[4]}}</view> 
        <text class="col2 shape batTxt"> 电池6：</text>
        <view class="col2 shape" placeholder="0.0V"> {{BatV[5]}} </view>
        <text class="col1 shape batTxt"> 电池7：</text>
        <view class="col1 shape" placeholder="0.0V"> {{BatV[6]}} </view>
        <text class="col2 shape batTxt"> 电池8：</text>
        <view class="col2 shape" placeholder="0.0V"> {{BatV[7]}} </view>
      </view>

      <view class="itemView">
        <text class="col1 shape batTxt"> 电池9：</text>
        <view class="col1 shape" placeholder="0.0V">{{BatV[8]}}</view> 
        <text class="col2 shape batTxt"> 电池10：</text>
        <view class="col2 shape" placeholder="0.0V"> {{BatV[9]}} </view>
        <text class="col1 shape batTxt"> 电池11：</text>
        <view class="col1 shape" placeholder="0.0V"> {{BatV[10]}} </view>
        <text class="col2 shape batTxt"> 电池12：</text>
        <view class="col2 shape" placeholder="0.0V"> {{BatV[11]}} </view>
      </view>
      <view class="itemView">
        <text class="col1 shape batTxt"> 电池13：</text>
        <view class="col1 shape" placeholder="0.0V">{{BatV[12]}}</view> 
        <text class="col2 shape batTxt"> 电池14：</text>
        <view class="col2 shape" placeholder="0.0V"> {{BatV[13]}} </view>
        <text class="col1 shape batTxt"> 电池15：</text>
        <view class="col1 shape" placeholder="0.0V"> {{BatV[14]}} </view>
        <text class="col2 shape batTxt"> 电池16：</text>
        <view class="col2 shape" placeholder="0.0V"> {{BatV[15]}} </view>
      </view>
    </view>
    <view class="connected_info" wx:if="{{connected}}">
      <view>
        <text>已连接到 {{name}}</text>
        <view class="operation">
          <button wx:if="{{canWrite}}" size="mini" bindtap="writeBLECharacteristicValue">写数据</button>
          <button size="mini" bindtap="closeBLEConnection">断开连接</button>
        </view>
      </view>
      <view wx:for="{{chs}}" wx:key="index" style="font-size: 12px; margin-top: 10px;">
        <view>特性UUID: {{item.uuid}}</view>
        <view>特性值: {{item.value}}</view>

      </view>
      <button wx:if="{{canWrite}}" size="mini" bindtap="SendCmd">Auto</button>
      <button wx:if="{{canWrite}}" size="mini" bindtap="GotoLogin">设置</button>
    </view>


  </view>
</view>

